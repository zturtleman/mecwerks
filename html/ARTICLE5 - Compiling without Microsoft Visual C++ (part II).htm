<SCRIPT SRC="http://ads.gamespy.com/jserver/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=PRESTITIAL?257989500"></SCRIPT><!--INSERTADTHISPAGE -->

<html>
<head>
	<title>Code3Arena</title>
</head>

<body background="../images/bg.gif" bgcolor="#660000" text="white" link="#C05F00" vlink="#d16545">


	<!-- BEGIN BANNER AD TABLE -->
<table width="100%" border=0 cellpadding=5 cellspacing=0 align="center" background="../images/bg.gif">
  <tr>
   	 <td width=468 height=60 align="CENTER" valign="top" bgcolor=#000000>
 <center><SCRIPT SRC="http://ads.gamespy.com/jserver/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257989500"></SCRIPT><NOSCRIPT><A HREF="http://ads.gamespy.com/cgi-bin/adclick.exe/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257989500"><IMG SRC="http://ads.gamespy.com/cgi-bin/adserver.exe/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257989500"></A></NOSCRIPT><!--ACCIPITERADINSERT/site=PQ/AAMSZ=IAB_FULL_BANNER/AREA=ARTICLES--></center>
</td>
  </tr>
</table>
	<!-- END BANNER AD TABLE -->

<br>

	<!-- BEGIN LOGO IMAGE TABLE -->
<table width="100%" cellspacing="0" cellpadding="0" border="1" align="center" bgcolor=#000000>
  <tr>
     <td align="CENTER">
	  <img src="/code3arena/images/logo.gif" width="500" height="137" border="0" alt="Code3Arena">
</td>
  </tr>
</table>
	<!-- END LOGO IMAGE TABLE -->
<p>

	<!-- BEGIN TOP HEIRARCHY -->
<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
  <tr>
    <td><img src="/code3arena/images/ouricon.gif"></td>
    <td width="100%" bgcolor=#000000>
	<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
	<A HREF="http://www.planetquake.com">PlanetQuake</A> |
	<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
	<A HREF="http://www.planetquake.com/code3arena/articles">Articles</A> |
	<a href="article4.shtml"><< Prev</a> |
	Article 5 |
	<a href="article6.shtml">Next >></a>
	</b></font>
    </td>
  </tr>
</table>
<p>
	<!-- END TOP HEIRARCHY -->

	<!-- BEGIN MAIN TABLE HERE-->
<table width="100%" border=0 cellpadding=0 cellspacing=0 align=center bgcolor=#4B0202>
  <tr>
  
   <!-- BEGIN LEFT NAVBAR MENU --> 
    <td valign=top bgcolor="#000000">
<table width=150 bgcolor="#000000" valign=top border=0 cellpadding=10 cellspacing=0 >
  <tr>
	 <td bgcolor=#000000 valign=top>
      <p>
      <a href="/code3arena/index.shtml"><img src="/code3arena/images/minilogo.gif" width="150" height="80" border="0" alt="menu"></a>
	  <p><!-- C40B02 -->
	  <font face=arial color="#C05F00" size=2>
<strong>
<LI> <a href="/code3arena/index.shtml">Home/News</a>
<LI> <a href="/code3arena/modsource.shtml">ModSource</a>
<LI> <a href="/code3arena/compilers.shtml">Compiling</a>
<LI> <a href="/code3arena/help.shtml">Help!!!</a>
<LI> <a href="/code3arena/submission.shtml">Submission</a>
<LI> <a href="/code3arena/contributors.shtml">Contributors</a>
<LI> <a href="/code3arena/staff.shtml">Staff</a>
<LI> <a href="/code3arena/downloads.shtml">Downloads</a>
</strong>
<P>

	    <img src="/code3arena/images/tutorials.gif" width="80" height="25" border="0" alt="Tutorials">
	  <font color="#C05F00" size=1>
<strong>
<BR> <a href="/code3arena/tutorials"> <  Index  ></a>
<BR> 1. <a href="/code3arena/tutorials/tutorial1.shtml">Mod making 101</a>
<BR> 2. <a href="/code3arena/tutorials/tutorial2.shtml">Up 'n running</a>
<BR> 3. <a href="/code3arena/tutorials/tutorial3.shtml">Hello, QWorld!</a>
<BR> 4. <a href="/code3arena/tutorials/tutorial4.shtml">Infinite Haste</a>
<BR> 5. <a href="/code3arena/tutorials/tutorial5.shtml">Armor Piercing Rails</a>
<BR> 6. <a href="/code3arena/tutorials/tutorial6.shtml">Bouncing Rockets</a>
<BR> 7. <a href="/code3arena/tutorials/tutorial7.shtml">Cloaking</a>
<BR> 8. <a href="/code3arena/tutorials/tutorial8.shtml">Ladders</a>
<BR> 9. <a href="/code3arena/tutorials/tutorial9.shtml">Favourite Server</a>
<BR> 10. <a href="/code3arena/tutorials/tutorial10.shtml">Flame Thrower</a>
<BR> 11. <a href="/code3arena/tutorials/tutorial11.shtml">Vortex Grenades</a>
<BR> 12. <a href="/code3arena/tutorials/tutorial12.shtml">Grapple</a>
<BR> 13. <a href="/code3arena/tutorials/tutorial13.shtml">Lightning Discharge</a>
<BR> 14. <a href="/code3arena/tutorials/tutorial14.shtml">Locational Damage</a>
<BR> 15. <a href="/code3arena/tutorials/tutorial15.shtml">Leg Shots</a>
<BR> 16. <a href="/code3arena/tutorials/tutorial16.shtml">Weapon Switching</a>
<BR> 17. <a href="/code3arena/tutorials/tutorial17.shtml">Scoreboard frag-rate</a>
<BR> 18. <a href="/code3arena/tutorials/tutorial18.shtml">Vortex Grenades II</a>
<BR> 19. <a href="/code3arena/tutorials/tutorial19.shtml">Vulnerable Missiles</a>
<BR> 20. <a href="/code3arena/tutorials/tutorial20.shtml">Creating Classes</a>
<BR> 21. <a href="/code3arena/tutorials/tutorial21.shtml">Scrolling Credits</a>
<BR> 22. <a href="/code3arena/tutorials/tutorial22.shtml">Weapon Dropping</a>
<BR> 23. <a href="/code3arena/tutorials/tutorial23.shtml">Anti-Gravity Boots</a>
<BR> 24. <a href="/code3arena/tutorials/tutorial24.shtml">HUD scoreboard</a>
<BR> 25. <a href="/code3arena/tutorials/tutorial25.shtml">Flashlight and laser</a>
<BR> 26. <a href="/code3arena/tutorials/tutorial26.shtml">Weapon Positioning</a>
<BR> 27. <a href="/code3arena/tutorials/tutorial27.shtml">Weapon Reloading</a>
<BR> 28. <a href="/code3arena/tutorials/tutorial28.shtml">Progressive Zooming</a>
<BR> 29. <a href="/code3arena/tutorials/tutorial29.shtml">Rotating Doors</a>
<BR> 30. <a href="/code3arena/tutorials/tutorial30.shtml">Beheading (headshot!)</a>
<BR> 31. <a href="/code3arena/tutorials/tutorial31.shtml">Alt Weapon Fire</a>
<BR> 32. <a href="/code3arena/tutorials/tutorial32.shtml">Popup Menus I</a>
<BR> 33. <a href="/code3arena/tutorials/tutorial33.shtml">Popup Menus II</a>
<BR> 34. <a href="/code3arena/tutorials/tutorial34.shtml">Cluster Grenades</a>
<BR> 35. <a href="/code3arena/tutorials/tutorial35.shtml">Homing Rockets</a>
<BR> 36. <a href="/code3arena/tutorials/tutorial36.shtml">Spreadfire Powerup</a>
<BR> 37. <a href="/code3arena/tutorials/tutorial37.shtml">Instagib gameplay</a>
<BR> 38. <a href="/code3arena/tutorials/tutorial38.shtml">Accelerating rockets</a>
<BR> 39. <a href="/code3arena/tutorials/tutorial39.shtml">Server only Instagib</a>
<BR> 40. <a href="/code3arena/tutorials/tutorial40.shtml">Advanced Grapple Hook</a>
<BR> 41. <a href="/code3arena/tutorials/tutorial41.shtml">Unlagging your mod</a>
</strong>
	  </font>
      <p><br>
	  
	  <img src="/code3arena/images/articles.gif" width="80" height="25" border="0" alt="Articles">
	  <font color="#C05F00" size=1>
<strong>
<BR> <a href="/code3arena/articles"> <  Index  > </a>
<BR> 1. <a href="/code3arena/articles/article1.shtml">Entities</A>
<BR> 2. <a href="/code3arena/articles/article2.shtml">Vectors</A>
<BR> 3. <a href="/code3arena/articles/article3.shtml">Good Coding</A>
<BR> 4. <a href="/code3arena/articles/article4.shtml">Compilers I</A>
<BR> 5. <a href="/code3arena/articles/article5.shtml">Compilers II</A>
<BR> 6. <a href="/code3arena/articles/article6.shtml">UI Menu Primer I</A>
<BR> 7. <a href="/code3arena/articles/article7.shtml">UI Menu Primer II</A>
<BR> 8. <a href="/code3arena/articles/article8.shtml">UI Menu Primer III</A>
<BR> 9. <a href="/code3arena/articles/article9.shtml">QVM Communication, Cvars, commands</A>
<BR> 10. <a href="/code3arena/articles/article10.shtml">Metrowerks CodeWarrior</A>
<BR> 11. <a href="/code3arena/articles/article11.shtml">1.27g code, bugs, batch</A>
</strong>
	  </font>
	  <p>
	  <!-- <hr color="#C0C0C0">  -->
	  <br>

	  <img src="/code3arena/images/links.gif" width="80" height="25" border="0" alt="Links">
	  <font color="#C05F00">
	  <small>
<li><a href="http://www.planetquake.com/quake3/files.shtml">Quake3 Files</a>
<li><a href="http://forums.planetquake.com/">Quake3 Forums</a>
<li><a href="http://dynamic.gamespy.com/~assim2/wwwshow.cgi?board=quake3">Q3A Editing Message Board</a>
<li><a href="http://www.planetquake.com/quake3/hosted/editing.shtml">Quake3 Editing</a>
	  </small>
	  </font>
	  <p><br>
	  
	  <img src="/code3arena/images/feedback.gif" width="80" height="25" border="0" alt="Feedback">
	  <font color="#C05F00">
	  <small>
<li><a href="mailto:sumfuka@planetquake.com">SumFuka</A>
<li><a href="mailto:calrathan@captured.com">Calrathan</A>
<li><a href="mailto:hypothermia@planetquake.com">
	<font color="#FF0000">H</font><font color="#FFFF00">y</font><font
	color="#CC33CC">p</font><font color="#3333FF">o</font>Thermia
	</A>
<li><a href="mailto:warzone@planetquake.com">WarZone</A>
	  </small>
	  </font>
	  <p><br>
	  
	  <img src="/counter/count.exe?ft=3&df=code3arena.dat&dd=D">
	   <p><br><br><br>
	  <small>Site Design by:</small>
	  <br>
	  <a href="mailto:ladyice@planetice.org,jeh@planetjeh.com"><img src="/code3arena/images/icelogo_sm.jpg" width="88" height="31" border="0" align="middle" alt="ICEmosis Design"></a>
	
	  </font>
	  <br><br>
    </td>

  </tr>
</table>
    </td>
	<!-- END LEFT NAVBAR MENU -->
	<!-- BEGIN DIVIDER -->
	<td valign=top background="../images/bg.gif">
<table width=20 cellpadding=0 cellspacing=0 border=0 background="../images/bg.gif">
  <tr>
	<td background="../images/bg.gif">
	  &nbsp;		
	</td>
  </tr>
</table>
	</td>
    <!-- END DIVIDER -->
	
	
	<!-- MAIN TEXT AREA -->
	<td valign=top bgcolor=#000000>
<table width="100%" cellpadding=15 cellspacing=10 border=0 bgcolor=#000000 valign=top>
  <tr>
	<td valign=top> 
<font face="Verdana, Arial" size="2" color="#eeeeee">

<center><font color="#C05F00" size=5><b>
ARTICLE 5 - Compiling without Microsoft Visual C++ (part II)</b>
</font><br>by <a href="mailto:hypothermia@planetquake.com"><font color="#FF0000">H</font><font color="#FFFF00">y</font><font color="#CC33CC">p</font><font color="#3333FF">o</font><font color="#FFFFFF">Thermia</font></A></center><p>

<p>If you've followed the steps in the <a href="article4.shtml">first part of the article</a>
you should already have the Quake3 Source compiled to run on the Virtual Machine.
This final part of the article covers how to get the code compiling to produce binaries
on your platform. 
<p>It is assumed that all of the modifications you've needed to make so far have been placed in
a separate directory under \Quake3\source.

<font color="#E07F44"><h4>
1. Compiling the binaries</h4></font>

<p>Being able to compile the bytecode for the QVM is the minimum amount
of work that needs to be done with your header files. To make further development
work easier using your compiler you need to develop the means to compile
binaries from the Q3Source.
<p>This is dictated by your compiler and platform. For command line tools
you should provide a makefile that defines the relationship between
the Q3Source and the compiled binaries. If your platform has a graphical
development environment then a project file would be desirable.
<br>&nbsp;

<font color="#E07F44"><h4>
1.1. Project files</h4></font>

The project file is the only thing that should be placed outside your compiler
directory. As the Microsoft Visual C++ project went in the \Quake3\source
directory, so should yours. If it is a makefile then try and give
it a meaningful name like makefile.gcc.linux.
<p>The work you've put in to understand the header files should now be
of benefit to you. If you needed to do any modifications to the Q3Source
then you shouldn't get error messages from these. Again, try to use existing
defined constants (related to your platform) within the Q3Source
to get the code compiling.
<p>There is no substitute for familiarity with your compiler tools.
<p>Take note that there are several files in source\game that
are also used to build the client (cgame) and user interface (ui).
<p>It would also be beneficial to have any intermediate files created by
your compiler placed in your custom compiler directory.

<p>Example:

<p>Borland tools use an Integrated Development
Environment (IDE). Each of the three modules needs to be compiled to a
DLL for Win32.
<p>Microsoft uses WIN32 to indicate compilation for Win32. The 
Q3Source header files respond to this, so it needs to be defined.
<p>The Borland IDE allows these values to be defined as part of the project
without modifying the Q3Source code. This is equivalent to the -Dxxxxxx
used with lcc.exe earlier.
<p>Borland compilers prepend an underscore to the name of exported
functions. This conflicts with the Microsoft way of things, so each
of the exported definitions in the *.def files needs to be modified
to:

<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
[EXPORTS]
  vmMain=_vmMain
  dllEntry=_dllEntry
</pre></font>

<p>Again, these files (one for each binary) are in the compiler specific
directory I'd created.
<br>&nbsp;


<font color="#E07F44"><h4>
1.2. Using C_ONLY in the project</h4></font>

<p>It is almost certainly necessary to include the following definition within
the project for each binary:
<p>#define C_ONLY
<p>Id wrote some Intel optimized assembler routines for some of
the performance critical math. If you can't compile that then define this
constant.
<br>&nbsp;

<font color="#E07F44"><h4>
1.3. Defining constants</h4></font>

If the Q3Source can already be compiled for your platform using
another compiler, then you might find it beneficial to define some or all
of the constants used by that compiler. Any modifications you need to make
might be built upon this.
<br>&nbsp;

<font color="#E07F44"><h4>
1.4. Handling system calls to Quake3</h4></font>

<p>IMPORTANT: One other compiler option required for the Wintel
release is "data structures aligned on 4-byte boundaries". If you don't 
use this option then you will see erratic and unexpected behaviour.
<p>Each of the three binary files you need to build are equivalent to the
three bytecode files for the QVM. For the Wintel platform they are called
qagamex86.dll, cgamex86.dll, and uix86.dll.
<p>Each requires that a file with a name like xx_syscalls.c is
included. It allows the binary to access optimized code within the Quake3
executable. You must ensure that QDECL is defined so that the
binary and executable can interface. The definition of QDECL is
in game\q_shared.h.
<p>Get it wrong and the game will crash.
<p>The function dllEntry() accepts the callback function in the
Quake3
executable. Despite the similar name to DllEntryPoint() used in
Win32 DLLs, it shouldn't be confused.
<br>&nbsp;

<font color="#E07F44"><h4>
1.5. Making sure Quake3 can use your binaries</h4></font>

<p>Only two functions need to be visible to the Quake3 executable:
vmMain()
and dllEntry(). Make sure these are exported from your binaries
in a way that Quake3 can see.
<br>&nbsp;

<font color="#E07F44"><h4>
1.6. Development only</h4></font>

<p>Building the server, client, and user interface code using binaries is
for debugging and testing purposes only. It is not for redistribution.
<br>&nbsp;

<font color="#E07F44"><h4>
2. Making modifications</h4></font>

<p>You will find that the Q3Source will generate quite a few warnings
when compiled. You should look at them to determine whether they are inconsequential.
For the most part they should be.
<p>As you've already got Q3Source compiling to the bytecode you
shouldn't find that there are major issues.
<p>If you should need to make modifications then keep the code portable.
<p>If you need to introduce platform specific code that fixes problems
or issues that you discover, then try and keep the source code in a separate
file in your custom compiler directory.
<br>&nbsp;

<font color="#E07F44"><h4>
3. Some possible errors</h4></font>

Some compilers have a slightly stricter interpretation of the C language
than others. If possible you should determine whether your compiler behaves
in the expected fashion.
<br>&nbsp;

<font color="#E07F44"><h4>
3.1. Some warnings in Q3Source</h4></font>

Id Software have used several coding styles that can trigger warning messages.
Some can be ignored, others should at least be checked.
<p>Errors like 'variable assigned a value but not used in function
xxxx' can be safely ignored. Whereas an error like 'Conversion
may lose significant digits' should be checked.
<p>One error that you might see is 'Possibly incorrect assignment'. This
is caused by the following type of code:

<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
for( j = 0; control = controls[j]; j++ )
</pre></font>

<p>At some point in the array controls[] an element is zero, this is guaranteed
by the usage of the array elsewhere. It also acts as a terminating condition,
the for-loop will terminate at the first zero value. It is equivalent to:

<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
for( j = 0; (control = controls[j])==0; j++ )
</pre></font>

<p>and can be ignored.
<br>&nbsp;

<font color="#E07F44"><h4>
3.2. Check your math library implementation</h4></font>

<p>Depending on how your math library is implemented, you may find you are
getting sqrt:DOMAIN errors when using your build of cgame.
<p>This arises from what appears to be a bug in the Quake3 executable
(build 1.15c) that results in the Q3Source trying to find a vector
perpendicular to {0,0,0}.
<p>Fixing this is compiler dependent. You need to find a way to intercept
and ignore this error: check the help files for your compiler and its math
library. Your solution should be placed among your compiler dependent files,&nbsp;
<p>The bug manifests itself when viewing demo001.dm3 with "timedemo
1".
<br>&nbsp;

<p>Example:

This error is generated by the Borland math library implementation.
The solution is to include this file in the build of the client game code
(cgame):
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
// borland_hack.c

#include &lt;math.h&gt;

int _RTLENTRY _EXPFUNC _matherr(struct exception* e)
{
   e->retval=1.0;
   return 1;
}
</pre></font>

<font color="#E07F44"><h4>
4. Testing the binaries</h4></font>

<p>Move the binaries into the same directory as your Quake3 executable,
and fire up Quake3.
<p>To make sure that the binaries are tested use sv_pure=0.
<p>Particularly important is the testing of demo001.dm3 using
"timedemo 1". If you get a sqrt:DOMAIN error then you will need to handle
this error generated by your math library.

<font color="#E07F44"><h4>
5. Setting up and distributing your project</h4></font>

<p>In setting up your work for distribution I would encourage the minimum
amount of modification to the Q3Source. You shouldn't need to go
in with a butcher's knife and make huge amounts of changes all over the
place.
<br>&nbsp;

<font color="#E07F44"><h4>
5.1 Use a separate directory for your work</h4></font>

<p>To help organize the changes you make I strongly recommend that you make
a directory under quake3\source to hold the files you create to
build the Q3Source successfully.
<p>This allows more than one compiler to work from the same source distribution,
and the source\cgame, source\game and source\ui
directories don't get cluttered up.
<p>The one exception to this is the project file you create to build binaries
for your platform. This should go in quake3\source and have a
unique and relevant name.
<br>&nbsp;

<font color="#E07F44"><h4>
5.2 Document your changes</h4></font>

<p>It is better for you to document your changes for someone else to apply
than redistribute modified source files. They can be integrated with an
existing project much more cleanly.
<p>Example:
<font face="Verdana, Arial" size="3" color="#ffffcc"><pre>
Open the header file game\q_shared.h and move to line 424, it should be:

float Q_crandom(int* seed);
Insert after it the following:
#ifdef __BORLANDC__
#ifdef random
#undef random
#endif
#endif
</pre></font>
<p>You might also consider distributing DIFF files.
<br>&nbsp;

<font color="#E07F44"><h4>
5.3 Make your work available on the Internet</h4></font>

<p>Others can then benefit from your hard work. Notify me so I can update
this site. Notify portals so others in the community can get the benefit
too.
<br>&nbsp;

<font color="#E07F44"><h4>
6. Congratulations!</h4></font>

<p>You've now got the Quake3 Source up and running.

<p>You can dig in and start on that mod you've got planned. You know, the one that's
going to blow the net away!



      <p>              
    </td>			  
  </tr>
</table>
	<!-- END MAIN TABLE -->
				                
  </tr>
</table>
<p>

	<!-- BEGIN BOTTOM HEIRARCHY -->
<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
  <tr>
    <td><img src="/code3arena/images/ouricon.gif"></td>
    <td width="100%" bgcolor=#000000>
	<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
	<A HREF="http://www.planetquake.com">PlanetQuake</A> |
	<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
	<A HREF="http://www.planetquake.com/code3arena/articles">Articles</A> |
	<a href="article4.shtml"><< Prev</a> |
	Article 5 |
	<a href="article6.shtml">Next >></a>
	</b></font>
    </td>
  </tr>
</table>
<p>
	<!-- END BOTTOM HEIRARCHY -->

</body>
</html>
