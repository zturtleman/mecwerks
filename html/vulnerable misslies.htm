<SCRIPT SRC="http://ads.gamespy.com/jserver/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=PRESTITIAL?257854515"></SCRIPT><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--INSERTADTHISPAGE -->

<html>
<head>
	<title>Code3Arena</title>
</head>

<body background="../images/bg.gif" bgcolor="#660000" text="white" link="#C05F00" vlink="#d16545">


	<!-- BEGIN BANNER AD TABLE -->
<table width="100%" border=0 cellpadding=5 cellspacing=0 align="center" background="../images/bg.gif">
  <tr>
   	 <td width=468 height=60 align="CENTER" valign="top" bgcolor=#000000>
 <center><SCRIPT SRC="http://ads.gamespy.com/jserver/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257854515"></SCRIPT><NOSCRIPT><A HREF="http://ads.gamespy.com/cgi-bin/adclick.exe/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257854515"><IMG SRC="http://ads.gamespy.com/cgi-bin/adserver.exe/SITE=PQ/AREA=HOSTED/GENRE=ACTION/TIER=3/AAMSZ=IAB_FULL_BANNER?257854515"></A></NOSCRIPT><!--ACCIPITERADINSERT/site=PQ/AAMSZ=IAB_FULL_BANNER/AREA=ARTICLES--></center>
</td>
  </tr>
</table>
	<!-- END BANNER AD TABLE -->

<br>

	<!-- BEGIN LOGO IMAGE TABLE -->
<table width="100%" cellspacing="0" cellpadding="0" border="1" align="center" bgcolor=#000000>
  <tr>
     <td align="CENTER">
	  <img src="/code3arena/images/logo.gif" width="500" height="137" border="0" alt="Code3Arena">
</td>
  </tr>
</table>
	<!-- END LOGO IMAGE TABLE -->
<p>

	<!-- BEGIN TOP HEIRARCHY -->
<table width="100%" cellpadding=0 cellspacing=0 border=0 bgcolor="#000000">
  <tr>
    <td><img src="/code3arena/images/ouricon.gif"></td>
    <td width="100%" bgcolor=#000000>
	<font face="Verdana, Arial" size="2" color="#eeeeee"><b>
	<A HREF="http://www.planetquake.com">PlanetQuake</A> |
	<A HREF="http://www.planetquake.com/code3arena">Code3Arena</A> |
	<A HREF="http://www.planetquake.com/code3arena/tutorials">Tutorials</A> |
	<a href="tutorial18.shtml"><< Prev</a> |
	Tutorial 19 |
	<a href="tutorial20.shtml">Next >></a>
	</b></font>
    </td>
  </tr>
</table>
<p>
	<!-- END TOP HEIRARCHY -->

	<!-- BEGIN MAIN TABLE HERE-->
<table width="100%" border=0 cellpadding=0 cellspacing=0 align=center bgcolor=#4B0202>
  <tr>
  
   <!-- BEGIN LEFT NAVBAR MENU --> 
    <td valign=top bgcolor="#000000">
<table width=150 bgcolor="#000000" valign=top border=0 cellpadding=10 cellspacing=0 >
  <tr>
	 <td bgcolor=#000000 valign=top>
      <p>
      <a href="/code3arena/index.shtml"><img src="/code3arena/images/minilogo.gif" width="150" height="80" border="0" alt="menu"></a>
	  <p><!-- C40B02 -->
	  <font face=arial color="#C05F00" size=2>
<strong>
<LI> <a href="/code3arena/index.shtml">Home/News</a>
<LI> <a href="/code3arena/modsource.shtml">ModSource</a>
<LI> <a href="/code3arena/compilers.shtml">Compiling</a>
<LI> <a href="/code3arena/help.shtml">Help!!!</a>
<LI> <a href="/code3arena/submission.shtml">Submission</a>
<LI> <a href="/code3arena/contributors.shtml">Contributors</a>
<LI> <a href="/code3arena/staff.shtml">Staff</a>
<LI> <a href="/code3arena/downloads.shtml">Downloads</a>
</strong>
<P>

	    <img src="/code3arena/images/tutorials.gif" width="80" height="25" border="0" alt="Tutorials">
	  <font color="#C05F00" size=1>
<strong>
<BR> <a href="/code3arena/tutorials"> <  Index  ></a>
<BR> 1. <a href="/code3arena/tutorials/tutorial1.shtml">Mod making 101</a>
<BR> 2. <a href="/code3arena/tutorials/tutorial2.shtml">Up 'n running</a>
<BR> 3. <a href="/code3arena/tutorials/tutorial3.shtml">Hello, QWorld!</a>
<BR> 4. <a href="/code3arena/tutorials/tutorial4.shtml">Infinite Haste</a>
<BR> 5. <a href="/code3arena/tutorials/tutorial5.shtml">Armor Piercing Rails</a>
<BR> 6. <a href="/code3arena/tutorials/tutorial6.shtml">Bouncing Rockets</a>
<BR> 7. <a href="/code3arena/tutorials/tutorial7.shtml">Cloaking</a>
<BR> 8. <a href="/code3arena/tutorials/tutorial8.shtml">Ladders</a>
<BR> 9. <a href="/code3arena/tutorials/tutorial9.shtml">Favourite Server</a>
<BR> 10. <a href="/code3arena/tutorials/tutorial10.shtml">Flame Thrower</a>
<BR> 11. <a href="/code3arena/tutorials/tutorial11.shtml">Vortex Grenades</a>
<BR> 12. <a href="/code3arena/tutorials/tutorial12.shtml">Grapple</a>
<BR> 13. <a href="/code3arena/tutorials/tutorial13.shtml">Lightning Discharge</a>
<BR> 14. <a href="/code3arena/tutorials/tutorial14.shtml">Locational Damage</a>
<BR> 15. <a href="/code3arena/tutorials/tutorial15.shtml">Leg Shots</a>
<BR> 16. <a href="/code3arena/tutorials/tutorial16.shtml">Weapon Switching</a>
<BR> 17. <a href="/code3arena/tutorials/tutorial17.shtml">Scoreboard frag-rate</a>
<BR> 18. <a href="/code3arena/tutorials/tutorial18.shtml">Vortex Grenades II</a>
<BR> 19. <a href="/code3arena/tutorials/tutorial19.shtml">Vulnerable Missiles</a>
<BR> 20. <a href="/code3arena/tutorials/tutorial20.shtml">Creating Classes</a>
<BR> 21. <a href="/code3arena/tutorials/tutorial21.shtml">Scrolling Credits</a>
<BR> 22. <a href="/code3arena/tutorials/tutorial22.shtml">Weapon Dropping</a>
<BR> 23. <a href="/code3arena/tutorials/tutorial23.shtml">Anti-Gravity Boots</a>
<BR> 24. <a href="/code3arena/tutorials/tutorial24.shtml">HUD scoreboard</a>
<BR> 25. <a href="/code3arena/tutorials/tutorial25.shtml">Flashlight and laser</a>
<BR> 26. <a href="/code3arena/tutorials/tutorial26.shtml">Weapon Positioning</a>
<BR> 27. <a href="/code3arena/tutorials/tutorial27.shtml">Weapon Reloading</a>
<BR> 28. <a href="/code3arena/tutorials/tutorial28.shtml">Progressive Zooming</a>
<BR> 29. <a href="/code3arena/tutorials/tutorial29.shtml">Rotating Doors</a>
<BR> 30. <a href="/code3arena/tutorials/tutorial30.shtml">Beheading (headshot!)</a>
<BR> 31. <a href="/code3arena/tutorials/tutorial31.shtml">Alt Weapon Fire</a>
<BR> 32. <a href="/code3arena/tutorials/tutorial32.shtml">Popup Menus I</a>
<BR> 33. <a href="/code3arena/tutorials/tutorial33.shtml">Popup Menus II</a>
<BR> 34. <a href="/code3arena/tutorials/tutorial34.shtml">Cluster Grenades</a>
<BR> 35. <a href="/code3arena/tutorials/tutorial35.shtml">Homing Rockets</a>
<BR> 36. <a href="/code3arena/tutorials/tutorial36.shtml">Spreadfire Powerup</a>
<BR> 37. <a href="/code3arena/tutorials/tutorial37.shtml">Instagib gameplay</a>
<BR> 38. <a href="/code3arena/tutorials/tutorial38.shtml">Accelerating rockets</a>
<BR> 39. <a href="/code3arena/tutorials/tutorial39.shtml">Server only Instagib</a>
<BR> 40. <a href="/code3arena/tutorials/tutorial40.shtml">Advanced Grapple Hook</a>
<BR> 41. <a href="/code3arena/tutorials/tutorial41.shtml">Unlagging your mod</a>
</strong>
	  </font>
      <p><br>
	  
	  <img src="/code3arena/images/articles.gif" width="80" height="25" border="0" alt="Articles">
	  <font color="#C05F00" size=1>
<strong>
<BR> <a href="/code3arena/articles"> <  Index  > </a>
<BR> 1. <a href="/code3arena/articles/article1.shtml">Entities</A>
<BR> 2. <a href="/code3arena/articles/article2.shtml">Vectors</A>
<BR> 3. <a href="/code3arena/articles/article3.shtml">Good Coding</A>
<BR> 4. <a href="/code3arena/articles/article4.shtml">Compilers I</A>
<BR> 5. <a href="/code3arena/articles/article5.shtml">Compilers II</A>
<BR> 6. <a href="/code3arena/articles/article6.shtml">UI Menu Primer I</A>
<BR> 7. <a href="/code3arena/articles/article7.shtml">UI Menu Primer II</A>
<BR> 8. <a href="/code3arena/articles/article8.shtml">UI Menu Primer III</A>
<BR> 9. <a href="/code3arena/articles/article9.shtml">QVM Communication, Cvars, commands</A>
<BR> 10. <a href="/code3arena/articles/article10.shtml">Metrowerks CodeWarrior</A>
<BR> 11. <a href="/code3arena/articles/article11.shtml">1.27g code, bugs, batch</A>
</strong>
	  </font>
	  <p>
	  <!-- <hr color="#C0C0C0">  -->
	  <br>

	  <img src="/code3arena/images/links.gif" width="80" height="25" border="0" alt="Links">
	  <font color="#C05F00">
	  <small>
<li><a href="http://www.planetquake.com/quake3/files.shtml">Quake3 Files</a>
<li><a href="http://forums.planetquake.com/">Quake3 Forums</a>
<li><a href="http://dynamic.gamespy.com/~assim2/wwwshow.cgi?board=quake3">Q3A Editing Message Board</a>
<li><a href="http://www.planetquake.com/quake3/hosted/editing.shtml">Quake3 Editing</a>
	  </small>
	  </font>
	  <p><br>
	  
	  <img src="/code3arena/images/feedback.gif" width="80" height="25" border="0" alt="Feedback">
	  <font color="#C05F00">
	  <small>
<li><a href="mailto:sumfuka@planetquake.com">SumFuka</A>
<li><a href="mailto:calrathan@captured.com">Calrathan</A>
<li><a href="mailto:hypothermia@planetquake.com">
	<font color="#FF0000">H</font><font color="#FFFF00">y</font><font
	color="#CC33CC">p</font><font color="#3333FF">o</font>Thermia
	</A>
<li><a href="mailto:warzone@planetquake.com">WarZone</A>
	  </small>
	  </font>
	  <p><br>
	  
	  <img src="/counter/count.exe?ft=3&df=code3arena.dat&dd=D">
	   <p><br><br><br>
	  <small>Site Design by:</small>
	  <br>
	  <a href="mailto:ladyice@planetice.org,jeh@planetjeh.com"><img src="/code3arena/images/icelogo_sm.jpg" width="88" height="31" border="0" align="middle" alt="ICEmosis Design"></a>
	
	  </font>
	  <br><br>
    </td>

  </tr>
</table>
    </td>
	<!-- END LEFT NAVBAR MENU -->
	<!-- BEGIN DIVIDER -->
	<td valign=top background="../images/bg.gif">
<table width=20 cellpadding=0 cellspacing=0 border=0 background="../images/bg.gif">
  <tr>
	<td background="../images/bg.gif">
	  &nbsp;		
	</td>
  </tr>
</table>
	</td>
    <!-- END DIVIDER -->
	
	
	<!-- MAIN TEXT AREA -->

<td VALIGN=TOP BGCOLOR="#000000">
<table BORDER=0 CELLSPACING=10 CELLPADDING=15 WIDTH="100%" BGCOLOR="#000000" valign="top" >
<tr>
<td VALIGN=TOP>
<font face="Verdana, Arial" size="2" color="#eeeeee">

<center><b><font face="Verdana"><font color="#C05F00"><font size=+2>TUTORIAL
19 - Vulnerable Missiles</font></font></font></b>
<br><font face="Verdana"><font color="#EEEEEE"><font size=-1>by
<b><a href="mailto:mjnikkan@engmail.uwaterloo.ca">Lancer</a></b></font></font></font></center>

<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>Thanks go to
<a href="mailto:chilton@scci-ad.com">Chris
Hilton</a> for his Q2
<a href="http://www.planetquake.com/qdevels/quake2/28_1_98i.html">Vulnerable
Rockets</a> Tutorial on <a href="http://www.planetquake.com/qdevels/">QDevels</a>
upon which much of this tutorial is based.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>This tutorial
explains how to make rockets or grenades or any missile in general, vulnerable
to being shot and destroyed.&nbsp; I was trying to do this myself, and
after checking various forums noticed that a few people had some small
problems with it.&nbsp; Once I got it working, I decided I might as well
share what I've found.&nbsp; The process is actually quite easy and only
a few changes have to be made.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>Files modified:</font></font></font>
<br><font face="Verdana"><font color="#EEEEEE"><font size=-1>g_missile.c</font></font></font>
<br><font face="Verdana"><font color="#EEEEEE"><font size=-1>g_weapon.c</font></font></font>
<br>&nbsp;

<font color="#E07F44"><h4>
1. ENTITY FUNCTION POINTERS
</h4></font>

<font face="Verdana"><font color="#EEEEEE"><font size=-1>First off, let's
look at g_local.h to get an idea of how Q3A deals with entities.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>Take a look
at the gentitys_t struct at about line 111:</font></font></font>
<br>&nbsp;
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>void (*think)(gentity_t *self);
void (*reached)(gentity_t *self);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // movers call this when hitting endpoint
void (*blocked)(gentity_t *self, gentity_t *other);
void (*touch)(gentity_t *self, gentity_t *other, trace_t *trace);
void (*use)(gentity_t *self, gentity_t *other, gentity_t *activator);
void (*pain)(gentity_t *self, gentity_t *attacker, int damage);
void (*die)(gentity_t *self, gentity_t *inflictor, gentity_t *attacker,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int damage, int mod);</font></font></font></pre>

<p><br><font face="Verdana"><font color="#FFFFFF"><font size=-1>These are
different function types that get executed when the entity is in a certain
situation.&nbsp; I will not explain what all of these are for, except that
the one we are concerned with is the die function pointer.&nbsp; die gets
called when an entity's health goes to or below 0 after being damaged.&nbsp;
You can confirm this for yourself by checking out the end of G_Damage function
in the g_combat.c file.</font></font></font>
<br>&nbsp;

<font color="#E07F44"><h4>
2. CREATING A DIE FUNCTION
</h4></font>

<font face="Verdana"><font color="#FFFFFF"><font size=-1>Add the following
function in g_missile.c just after G_ExplodeMissile.</font></font></font>
<pre><font face="Verdana"><font color="#FF6666"><font size=+0>/*
================
G_MissileDie

Lancer - Destroy a missile
================
*/
void G_MissileDie( gentity_t *self, gentity_t *inflictor,</font></font></font></pre>

<pre><font face="Verdana"><font color="#FF6666"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gentity_t *attacker, int damage, int mod ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (inflictor == self)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self->takedamage = qfalse;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self->think = G_ExplodeMissile;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self->nextthink = level.time + 10;
}</font></font></font></pre>

<p><br><font face="Verdana"><font color="#EEEEEE"><font size=-1>All this
function does is catch when a missile has been killed and set the missile
to explode within a short period of time.&nbsp; We ignore the case where
the inflictor of the damage is the same missile suffering the damage.&nbsp;
This case should already be avoided, but this will cover your @$$ in case
something weird happens.&nbsp; We also stop it from taking damage again,
since it's possible that hitting it persistently will cause it to take
forever to die.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>You can adjust
the nextthink time frame to whatever you want.&nbsp; I simply chose the
one from the Q2 <a href="http://www.planetquake.com/qdevels/quake2/28_1_98i.html">Vulnerable
Rockets</a> tutorial by <a href="mailto:chilton@scci-ad.com">Chris Hilton</a>
on the <a href="http://www.planetquake.com/qdevels/">QDevels</a> board,
since it seemed very reasonable.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>Note that I've
also set the think function to G_ExplodeMissile.&nbsp; While this is redundant
in this mod, if you set the think function of your missile to anything
else (for whatever reason) in your mod, this will ensure that the next
think the missile does is to explode.</font></font></font>
<br>&nbsp;

<font color="#E07F44"><h4>
3. GIVING LIFE TO OUR MISSILES
</h4></font>

<font face="Verdana"><font color="#EEEEEE"><font size=-1>So now we have
the means of death, let's make a missile destructible!&nbsp; In this case,
I'm going to look at making a rocket vulnerable, though any other sort
of
missile (grenade, bfg, plasma) can be changed in the same way.&nbsp; Go
to fire_rocket in g_missile.c, and find this segment of code:</font></font></font>
<br>&nbsp;
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->nextthink = level.time + 10000;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->think = G_ExplodeMissile;</font></font></font></pre>

<p><br><font face="Verdana"><font color="#EEEEEE"><font size=-1>Now add
the following:</font></font></font>
<br>&nbsp;
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->nextthink = level.time + 10000;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->think = G_ExplodeMissile;</font></font></font></pre>

<pre><font face="Verdana"><font color="#FF6666"><font size=+0>// Lancer
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->health = 5;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->takedamage = qtrue;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->die = G_MissileDie;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bolt->r.contents = CONTENTS_BODY;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorSet(bolt->r.mins, -10, -3, 0);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorCopy(bolt->r.mins, bolt->r.absmin);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorSet(bolt->r.maxs, 10, 3, 6);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorCopy(bolt->r.maxs, bolt->r.absmax);</font></font></font></pre>

<p><br><font face="Verdana"><font color="#EEEEEE"><font size=-1>The first
thing we add is some health to the rocket.&nbsp; 5 is enough for just about
anything in Quake to kill it.&nbsp; We also must allow this entity to takedamage
in the game, and then we point the die function pointer to our G_MissileDie
function.&nbsp; These 3 lines were added primarily for the sake of the
G_Damage function, so that it will damage the rocket, subtract health,
and call the die function once it has been killed.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>The next five
lines are for the sake of the trap_Trace function which just about every
weapon in the game uses.&nbsp; The first line gives the object a solid
body, so-to-speak.&nbsp; CONTENTS_BODY will intercept all kinds of fire.&nbsp;
You could choose CONTENTS_CORPSE here too, but the only real difference
is that the one launching the rocket will be able to clip through it on
the CONTENTS_CORPSE setting.&nbsp; CONTENTS_BODY gives it a solid feel
(eg: if you were modifying a grenade, you'd feel like you were actually
stepping on something if you walked over it (I don't recommend walking
over grenades though)).</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>The next four
lines define a bounding box which sets the dimensions that the trap_Trace
function will clip against.&nbsp; Think of it as mins being one corner
of a box, and the maxs being the opposing corner.&nbsp; Again, the values
I used for these vectors were taken from the Q2 <a href="http://www.planetquake.com/qdevels/quake2/28_1_98i.html">Vulnerable
Rockets</a> tutorial by <a href="mailto:chilton@scci-ad.com">Chris Hilton</a>.&nbsp;
I also copy each vector to the corresponding absmin/absmax vectors for
safety's sake.</font></font></font>
<p><font face="Verdana"><font color="#EEEEEE"><font size=-1>And for testing,
let's slow down the rockets so they makes an easy target.&nbsp; Change
the following line near the end of fire_rocket from:</font></font></font>
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorScale( dir, 900, bolt->s.pos.trDelta );</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>to:</font></font></font>
<pre><font face="Verdana"><font size=+0><font color="#FFFFCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VectorScale( dir, </font><font color="#FF6666">100</font><font color="#FFFFCC">, bolt->s.pos.trDelta );</font></font></font></pre>
&nbsp;

<font color="#E07F44"><h4>
4. IS THAT ALL THERE IS?
</h4></font>

<font face="Verdana"><font color="#FFFFFF"><font size=-1>This is actually
all you need for your basic vulnerable missile.&nbsp; However, if you try
compiling and running it, you will notice that if you fire a rocket and
try to shoot it down with your machinegun, it won't blow up!&nbsp; On the
otherhand, if you either blow something else up near it (like firing a
rocket at the ground), or load up some bots to fire rockets for you to
shoot, you will find that they *do* blow up.&nbsp; So we know that our
code is working, but why can't we shoot them down ourselves?</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>Go into g_weapon.c
and take a look on the Bullet_Fire function at this line:</font></font></font>
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trap_Trace (&amp;tr, muzzle, NULL, NULL, end,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ent->s.number, MASK_SHOT);</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>This system call
traces a line for a certain distance and stops at the first entity it encounters.&nbsp;
Notice the second last paramter though:</font></font></font>
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ent->s.number</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>This identifies
the client number, or essentially skips the owner of the entity.&nbsp;
This means you're not going to be able to shoot down your own missiles!&nbsp;
Change the line to:</font></font></font>
<pre><font face="Verdana"><font size=+0><font color="#FFFFCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trap_Trace (&amp;tr, muzzle, NULL, NULL, end,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font color="#FF6666">ENTITYNUM_NONE</font><font color="#FFFFCC">, MASK_SHOT);</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>Now your rockets
become a valid target (and technically so do you), but only for your machinegun
bullets.&nbsp; You'd have to change the trap_Trace function for every weapon
you want to be able to shoot your own missiles down with.&nbsp; But since
there's really no reason to shoot at your own missiles, let's just use
the machinegun this way to look at our handiwork.</font></font></font>
<br>&nbsp;

<font color="#E07F44"><h4>
5. FINISHING TOUCHES
</h4></font>

<font face="Verdana"><font color="#FFFFFF"><font size=-1>Now if you compile
and run, you'll be able to shoot down your own rockets like the slow slugs
they are.&nbsp; But without any Bots hounding us, you might notice that
whenever your rocket hits a wall the "hit" sound gets played.&nbsp; This
seems out of place.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>If you think
about it a little, you'll realize what's happening.&nbsp; The only thing
that's actually getting hit is your own rocket.&nbsp; The way Quake 3 Arena
seems to work is that the rocket explodes before the entity is cleared
away.&nbsp; Therefore, even though the rocket hits a wall and explodes,
it's within its own blast-radius and attempts to damage itself.&nbsp; This
registers a "hit" sound.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>This can easily
be fixed.&nbsp; A rocket can explode in two ways, either it hits a wall
or it explodes after its nextthink time is reached.&nbsp; Open up g_missile.c
again, and we'll add a single line in two places.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>In G_MissileImpact
look for:</font></font></font>
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>// check for bounce
if ( !other->takedamage &amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( ent->s.eFlags &amp; ( EF_BOUNCE | EF_BOUNCE_HALF ) ) ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; G_BounceMissile( ent, trace );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; G_AddEvent( ent, EV_GRENADE_BOUNCE, 0 );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;
}</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>and add in:</font></font></font>
<pre><font face="Verdana"><font size=+0><font color="#FFFFCC">// check for bounce
if ( !other->takedamage &amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( ent->s.eFlags &amp; ( EF_BOUNCE | EF_BOUNCE_HALF ) ) ) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; G_BounceMissile( ent, trace );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; G_AddEvent( ent, EV_GRENADE_BOUNCE, 0 );
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;
}

</font><font color="#FF6666">// Lancer
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ent->takedamage = qfalse;</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>G_MissileImpact
is what happens whenever a missile hits anything, be it floor, wall or
Quake d00d.&nbsp; If we turn off takedamage here, it will ensure that the
only hit registered is that of another player being hit.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>Note that this
line is inserted after a bouncing object leaves the function, so that grenades
don't become indestructible after the first bounce.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>Now look in
G_Explode, right after the vector declarations:</font></font></font>
<pre><font face="Verdana"><font color="#FFFFCC"><font size=+0>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vec3_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dir;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vec3_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origin;</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>and add in:</font></font></font>
<pre><font face="Verdana"><font size=+0><font color="#FFFFCC">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vec3_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dir;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vec3_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; origin;

</font><font color="#FF6666">// Lancer
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ent->takedamage = qfalse;</font></font></font></pre>
<font face="Verdana"><font color="#FFFFFF"><font size=-1>This is the only
other place that missiles seem to explode.&nbsp; Therefore, turn the takedamage
boolean off so we don't register a hit because of our exploding missile.</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>If you compile
and run now, no longer will you hear those "bip" sounds when your rockets
impact walls.&nbsp; Now you're all set to try and either dodge those incoming
missiles, or shoot 'em down! Also, feel free to set your rocket speed to
whatever you want (since 100 is way too slow in a practical game).&nbsp;
To make grenades or other missile objects shootable, just copy what you've
got in fire_rocket now and stick it into the corresponding missile's fire
function.&nbsp; Play with the vectors a bit, compile and blow 'em up!</font></font></font>
<p><font face="Verdana"><font color="#FFFFFF"><font size=-1>Shoot straight
and have fun!</font></font></font></td>
</tr>
</table>
<!-- END MAIN TABLE --></td>
</tr>
</table>

<p><!-- BEGIN BOTTOM HEIRARCHY -->
<table BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH="100%" BGCOLOR="#000000" >
<tr>
<td><img SRC="ouricon.gif" ></td>

<td WIDTH="100%" BGCOLOR="#000000"><b><font face="Verdana, Arial"><font color="#EEEEEE"><font size=-1><a href="http://www.planetquake.com">PlanetQuake</a>
| <a href="http://www.planetquake.com/code3arena">Code3Arena</a> | <a href="http://www.planetquake.com/code3arena/tutorials">Tutorials</a>
| <a href="tutorial18.shtml">&lt;&lt; Prev</a> | Tutorial 19 | <a href="tutorial20.shtml">Next
>></a></font></font></font></b></td>
</tr>
</table>

<p><!-- END BOTOTM HEIRARCHY -->
</body>
</html>
